!function(){"use strict";var t={apiKey:"d62132a71a9144c3594bd6a136b16dfc",baseUrl:"https://api.openweathermap.org/",get:function(t,e){var n="".concat(this.baseUrl,"data/2.5/weather?lat=").concat(t,"&lon=").concat(e,"&appid=").concat(this.apiKey);return fetch(n).then((function(t){return t.json()}))},findCityCoords:function(t){var e="".concat(this.baseUrl,"geo/1.0/direct?q=").concat(t,"&limit=1&appid=").concat(this.apiKey);return fetch(e).then((function(t){return t.json()})).then((function(t){return new Promise((function(e,n){t[0]&&e(t[0]),n(new Error("City was not found"))}))}))},toCelsius:function(t){return parseFloat(t)-273.15}},e=function(){return fetch("https://get.geojs.io/v1/ip/geo.json").then((function(t){return t.json()}))};function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"apiKey","AIzaSyB1RMnKzcvlp3v90ei9EUIFlAn5qbFuzqc"),i(this,"baseUrl","https://maps.googleapis.com/maps/api/staticmap"),i(this,"container",void 0),this.container=e}var e,r;return e=t,(r=[{key:"render",value:function(t,e){var n={key:this.apiKey,size:"640x640",center:"".concat(t,",").concat(e),zoom:10,map_id:"fa7cf5ec5edea579"},i=new URLSearchParams(n),r="".concat(this.baseUrl,"?").concat(i.toString()),o=document.createElement("img");o.src=r,this.container.innerHTML="",this.container.append(o)}}])&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var c=new(function(){function e(t){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"rootElement",void 0),a(this,"city",void 0),a(this,"t",void 0),a(this,"form",void 0),a(this,"input",void 0),a(this,"searchHistory",void 0),a(this,"storage",void 0),a(this,"map",void 0),a(this,"onSubmitSearch",(function(t){t.preventDefault(),n.showCityWeather(n.input.value)})),a(this,"onClickCity",(function(t){n.showCityWeather(t.target.innerHTML)})),this.rootElement=t,this.storage=window.localStorage,this.map=new r(this.rootElement.querySelector(".map-panel")),this.city=this.rootElement.querySelector(".weather-data__city"),this.t=this.rootElement.querySelector(".weather-data__temp"),this.form=this.rootElement.querySelector(".city-form"),this.input=this.rootElement.querySelector(".text-field__input"),this.searchHistory=this.rootElement.querySelector(".search-history"),this.form.addEventListener("submit",this.onSubmitSearch),this.city.innerHTML="Определяем ваше местоположение... Разрешите геолокацию",this.renderSearchHistory()}var n,i;return n=e,(i=[{key:"render",value:function(e){var n=t.toCelsius(e.main.temp);this.t.innerHTML="".concat((n>0?"+":"")+n.toFixed(),"°C"),this.city.innerHTML=e.name,this.renderSearchHistory(),this.map.render(e.coord.lat,e.coord.lon)}},{key:"renderSearchHistory",value:function(){var t=this;this.searchHistory.innerHTML="",this.getHistory().forEach((function(e){var n=document.createElement("button");n.className="tag-btn",n.innerHTML=e,n.addEventListener("click",t.onClickCity),t.searchHistory.append(n)}))}},{key:"showCityWeather",value:function(e){var n=this;this.lockPage(),t.findCityCoords(e).then((function(e){return t.get(e.lat,e.lon)})).then((function(t){n.saveHistory(e),n.render(t)})).catch((function(t){return console.error(t)})).finally((function(){return n.unlockPage()}))}},{key:"saveHistory",value:function(t){var e=this.getHistory();(e=e.filter((function(e){return e!==t}))).push(t),this.storage.setItem("history",JSON.stringify(e))}},{key:"getHistory",value:function(){return(JSON.parse(this.storage.getItem("history"))||[]).reverse()}},{key:"lockPage",value:function(){this.input.disabled=!0}},{key:"unlockPage",value:function(){this.input.disabled=!1,this.input.value=""}}])&&o(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),e}())(document.getElementById("container"));e().then((function(e){return t.get(e.latitude,e.longitude)})).then((function(t){return c.render(t)}))}();
//# sourceMappingURL=bundle.js.map